---
title: "Preprocess Cleaned Data"
author: "Shanti Agung"
date: "4/22/2021"
output: html_document
---

This notebook is to explore preprocessing cleaned dataset for variables needed for modelling.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

```{r}
# load dataset
dispositions <- read_csv(file.path(rprojroot::find_root(rprojroot::is_rstudio_project),
                                   "data", "offenses_dispositions_v3_grades.csv"),
                         col_types = cols(
  #X1 = col_double(),
  docket_id = col_double(),
  description = col_character(),
  statute_description = col_character(),
  statute_name = col_character(),
  sequence_number = col_double(),
  grade = col_character(),
  disposition = col_character(),
  disposing_authority__first_name = col_character(),
  disposing_authority__middle_name = col_character(),
  disposing_authority__last_name = col_character(),
  disposing_authority__title = col_character(),
  disposing_authority__document_name = col_character(),
  disposition_method = col_character(),
  min_period = col_character(),
  max_period = col_character(),
  period = col_character(),
  credit = col_double(),
  sentence_type = col_character(),
  min_period_parsed = col_character(),
  max_period_parsed = col_character(),
  min_period_days = col_character(),
  max_period_days = col_double(),
  grade_backfilled = col_character()
))
```


## Unit of analysis

Unit of analysis will be `docket_id`, rather than offense,  because judges seem to make sentencing decision based on overall bundle of offenses within a docket, rather than individual offense. One example of this decision making process is that some offenses are merged.

## Target (dependent) variables

Several possible target variables:
1. Days of confinement sentences
2. Binary: confinement and non-confinement
3. ...

### Days of confinement 

```{r}
dispositions %>% 
  count(sentence_type)
```

Aside from "Confinement", there are four other values of `sentence_type`. By defining days of confinement as the dependent variable:
* `days_of_confinement` is the value of `max_period_days` if `sentence_type` is "Confinement".
* `days_confinement` is 0 for all other values of `sentence_type`.

How many "Confinement" are there in a docket?
```{r}
dispositions %>% 
  mutate(is_confinement = if_else(sentence_type == "Confinement", TRUE, FALSE)) %>% 
  group_by(docket_id) %>% 
  summarise(n_confinement = sum(is_confinement)) %>% 
  ungroup() %>% 
  count(n_confinement)
```
The majority of dockets do not result in confinement. Some dockets list more than one confinement as `sentence_type` of its offenses. Let's take a look at some of these dockets.

```{r}
dispositions %>% 
  mutate(is_confinement = if_else(sentence_type == "Confinement", TRUE, FALSE)) %>% 
  group_by(docket_id) %>% 
  summarise(n_confinement = sum(is_confinement)) %>% 
  ungroup() %>% 
  filter(n_confinement == 4)
```
`docket_id` number 3 has two offenses that results in confinement. Let's look closer. 
```{r}
dispositions %>% 
  filter(docket_id == 3)
```
`docket_id` = 3 has 3 offenses, two of them results in confinement. One for 700 days and the other for 1826 days.

Let's look at another `docket_id`. `docket_id` = 104 has 




